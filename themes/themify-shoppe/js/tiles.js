var Tiles={};!function(t){var e=Tiles.Tile=function(e,i){this.id=e,this.top=0,this.left=0,this.width=0,this.height=0,this.$el=t(i||document.createElement("div"))};e.prototype.appendTo=function(t,e,i,s){this.$el.hide().appendTo(t),e?this.$el.delay(i).fadeIn(s):this.$el.show()},e.prototype.remove=function(e,i){e?this.$el.fadeOut({complete:function(){t(this).remove()}}):this.$el.remove()},e.prototype.resize=function(t,e,i,s,h){var l={},n=!1;this.left!==e.x&&(l.left=e.x,this.left=e.x,n=!0),this.top!==e.y&&(l.top=e.y,this.top=e.y,n=!0),this.width!==e.width&&(l.width=e.width,this.width=e.width,n=!0),this.height!==e.height&&(l.height=e.height,this.height=e.height,n=!0);var o=this,r=function(){var t=o.$el[0];o.left!==t.offsetLeft&&o.$el.css("left",o.left),o.top!==t.offsetTop&&o.$el.css("top",o.top),h&&h()};i&&n?this.$el.animate(l,{duration:s,easing:"swing",complete:r}):(n&&this.$el.css(l),setTimeout(r,s))}}(jQuery),function(t){function e(t,e,i,s){this.x=t,this.y=e,this.width=i,this.height=s}var i=function(t){var e,i,s,h,l,n=[],o=t.length;for(i=0;o>i;i++)for(s=t[i],n[i]=[],e=0,h=s.length;h>e;e++)l=s[e]," "!==l&&n[i].push(l);return n};e.prototype.copy=function(){return new e(this.x,this.y,this.width,this.height)},Tiles.Rectangle=e;var s=function(t){var i,s,h,l,n,o,r,a=[],p=t.length,u=0===p?0:t[0].length;for(t=t.slice(),n=0;p>n;n++)t[n]=t[n].slice();for(n=0;p>n;n++)for(l=0;u>l;l++)if(i=t[n][l],null!=i){if(h=1,s=1,i!==Tiles.Template.SINGLE_CELL){for(;u>h+l&&i===t[n][l+h];)h++;for(;p>s+n&&i===t[n+s][l];)s++}for(r=0;s>r;r++)for(o=0;h>o;o++)t[n+r][l+o]=null;a.push(new e(l,n,h,s))}return a};Tiles.Template=function(t,e,i){this.rects=t,this.numTiles=this.rects.length,this.numRows=i,this.numCols=e},Tiles.Template.prototype.copy=function(){var t,e,i=[];for(e=0,t=this.rects.length;t>e;e++)i.push(this.rects[e].copy());return new Tiles.Template(i,this.numCols,this.numRows)},Tiles.Template.prototype.append=function(t){if(this.numCols!==t.numCols)throw"Appended templates must have the same number of columns";var i,s,h,l=this.numRows;for(i=0,s=t.rects.length;s>i;i++)h=t.rects[i],this.rects.push(new e(h.x,l+h.y,h.width,h.height));this.numRows+=t.numRows,this.numTiles+=t.numTiles},Tiles.Template.fromJSON=function(t){var e=i(t),h=s(e);return new Tiles.Template(h,e.length>0?e[0].length:0,e.length)},Tiles.Template.prototype.toJSON=function(){var t,e,i,s,h,l,n="ABCDEFGHIJKLMNOPQRSTUVWXYZ",o=n.length,r=0,a=[];for(h=0;h<this.numRows;h++)for(a[h]=[],s=0;s<this.numCols;s++)a[h][s]=Tiles.Template.SINGLE_CELL;for(t=0,e=this.rects.length;e>t;t++)if(i=this.rects[t],i.width>1||i.height>1){for(l=n[r],h=0;h<i.height;h++)for(s=0;s<i.width;s++)a[i.y+h][i.x+s]=l;r=(r+1)%o}for(h=0;h<this.numRows;h++)a[h]=a[h].join("");return a},Tiles.Template.SINGLE_CELL="."}(jQuery),Tiles.UniformTemplates={get:function(t,e){var i,s,h=Math.ceil(e/t),l=[];for(s=0;h>s;s++)for(i=0;t>i;i++)l.push(new Tiles.Rectangle(i,s,1,1));return new Tiles.Template(l,t,h)}},function(t){function e(e){var i,s,h=[],l=e?e.length:0;for(i=0;l>i;i++)s=e[i],-1===t.inArray(s,h)&&h.push(s);return h}function i(t,e,i){var s=t.y+t.height,h=t.x+t.width;return e&&!(e.top>s||e.top+e.height<t.y||e.left>h||e.left+e.width<t.x)?!0:i&&!(i.y>s||i.y+i.height<t.y||i.x>h||i.x+i.width<t.x)?!0:!1}var s=Tiles.Grid=function(e){this.$el=t(e),this.animationDuration=300,this.cellSizeMin=150,this.templateFactory=Tiles.UniformTemplates,this.priorityPageSize=Number.MAX_VALUE,this.cellPadding=10,this.cellSize=0,this.numCols=1,this.template=null,this.isDirty=!0,this.tiles=[],this.tilesAdded=[],this.tilesRemoved=[]};s.prototype.getContentWidth=function(){return this.$el.width()},s.prototype.resizeColumns=function(){var t=this.getContentWidth();return Math.max(1,Math.floor((t+this.cellPadding)/(this.cellSizeMin+this.cellPadding)))},s.prototype.resizeCellSize=function(){var t=this.getContentWidth();return Math.ceil((t+this.cellPadding)/this.numCols)-this.cellPadding},s.prototype.resize=function(){var t=this.resizeColumns();this.numCols!==t&&t>0&&(this.numCols=t,this.isDirty=!0);var e=this.resizeCellSize();this.cellSize!==e&&e>0&&(this.cellSize=e,this.isDirty=!0)},s.prototype.updateTiles=function(i){i=e(i);var s,h,l,n,o=i.length,r=[];for(s=this.tiles.length-1;s>=0;s--)h=this.tiles[s],n=t.inArray(h.id,i),0>n?this.tilesRemoved.push(h):r[n]=h;for(this.tiles=[],s=0;o>s;s++){if(h=r[s],!h){if(l=i[s],this.createTile){if(h=this.createTile(l),!h)continue}else h=new Tiles.Tile(l);this.tilesAdded.push(h)}this.tiles.push(h)}},s.prototype.insertTiles=function(t){this.addTiles(t,!0)},s.prototype.addTiles=function(t,e){if(t&&0!==t.length){var i,s=[],h=this.tiles.length;for(i=0;h>i;i++)s.push(this.tiles[i].id);var l=e?t.concat(s):s.concat(t);this.updateTiles(l)}},s.prototype.removeTiles=function(e){if(e&&0!==e.length){var i,s,h,l=[];for(i=0,s=this.tiles.length;s>i;i++)h=this.tiles[i].id,-1===t.inArray(h,e)&&l.push(h);this.updateTiles(l)}},s.prototype.createTemplate=function(t,e){t=Math.max(1,t);var i=this.templateFactory.get(t,e);return i||(i=Tiles.UniformTemplates.get(t,e)),i},s.prototype.ensureTemplate=function(t){if(this.template&&this.template.numCols===this.numCols){var e=t-this.template.rects.length;e>0&&(this.template.append(this.createTemplate(this.numCols,e)),this.isDirty=!0)}else this.template=this.createTemplate(this.numCols,t),this.isDirty=!0},s.prototype.shouldRedraw=function(){this.cellSize<=0&&this.resize(),this.ensureTemplate(this.tiles.length);var t=this.isDirty||this.tilesAdded.length>0||this.tilesRemoved.length>0;return t},s.prototype.redraw=function(e,s,h){if(!this.shouldRedraw())return void(s&&s(!1,h));var l,n,o,r,a,p,u,c,f,d,m,g=this.tiles.length,T=this.priorityPageSize,y=this.animationDuration,v=this.cellSize+this.cellPadding,w=0,C=0,z=new Tiles.Rectangle(this.$el.scrollLeft(),this.$el.scrollTop(),this.$el.width(),this.$el.height());for(w=0;g>w;w+=T)for(o=this.template.rects.slice(w,w+T),r=this.tiles.slice(w,w+T),d=o.slice(0),m=r.slice(0),this.prioritizePage&&this.prioritizePage(d,m),a=0,p=m.length;p>a;a++)l=m[a],n=t.inArray(l,this.tilesAdded)>=0,u=d[a],c=new Tiles.Rectangle(u.x*v,u.y*v,u.width*v-this.cellPadding,u.height*v-this.cellPadding),l.resize(u,c,e&&!n&&i(z,l,c),y),n&&(f=e&&i(z,null,c),C=f&&this.getAppendDelay?this.getAppendDelay(u,o,d,l,r,m):0,l.appendTo(this.$el,f,C,y));for(a=0,p=this.tilesRemoved.length;p>a;a++)l=this.tilesRemoved[a],f=e&&i(z,l,null),l.remove(f,y);this.tilesRemoved=[],this.tilesAdded=[],this.isDirty=!1,s&&setTimeout(function(){s(!0,h)},y+10)}}(jQuery);